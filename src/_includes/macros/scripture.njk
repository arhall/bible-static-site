{# Scripture reference macro for embedded Bible verses #}

{# 
  Main Scripture reference macro
  Usage: {{ scripture("John 3:16", "For God so loved the world...") }}
  or:    {{ scripture("John 3:16") }} - will display reference as text
#}
{% macro scripture(reference, displayText="") %}
  <span data-scripture="{{ reference }}" class="scripture-reference" title="Click to view {{ reference }}">
    {%- if displayText -%}
      {{ displayText }}
    {%- else -%}
      {{ reference }}
    {%- endif -%}
  </span>
{% endmacro %}

{# 
  Inline Scripture reference for flow within text
  Usage: The Bible says {{ scriptureInline("John 3:16", "God so loved the world") }} and this shows...
#}
{% macro scriptureInline(reference, displayText="") %}
  <span data-scripture="{{ reference }}" class="scripture-reference inline" title="View {{ reference }}">
    {%- if displayText -%}
      {{ displayText }}
    {%- else -%}
      {{ reference }}
    {%- endif -%}
  </span>
{% endmacro %}

{# 
  Block Scripture reference for quotes or emphasis
  Usage: {{ scriptureBlock("Psalm 23:1", "The Lord is my shepherd, I shall not want") }}
#}
{% macro scriptureBlock(reference, displayText="", cssClass="") %}
  <div class="scripture-block {{ cssClass }}" data-scripture="{{ reference }}">
    <div class="scripture-text">{{ displayText }}</div>
    <div class="scripture-ref">‚Äî {{ reference }}</div>
  </div>
{% endmacro %}

{# 
  Scripture list for multiple references
  Usage: {{ scriptureList([
    {ref: "John 3:16", text: "For God so loved..."},
    {ref: "Romans 8:28", text: "All things work together..."}
  ]) }}
#}
{% macro scriptureList(scriptures, title="Related Scriptures") %}
  <div class="scripture-list">
    {% if title %}
      <h4 class="scripture-list-title">{{ title }}</h4>
    {% endif %}
    <ul class="scripture-items">
      {% for item in scriptures %}
        <li class="scripture-item">
          {{ scripture(item.ref, item.text or item.ref) }}
        </li>
      {% endfor %}
    </ul>
  </div>
{% endmacro %}

{# 
  Gospel connection macro - highlights Christ-centered connections
  Usage: {{ gospelConnection("Genesis 3:15", "This first promise points to Christ", "Romans 16:20") }}
#}
{% macro gospelConnection(reference, explanation, fulfillmentRef="") %}
  <div class="gospel-connection">
    <div class="gospel-connection-header">
      <span class="gospel-icon">‚úùÔ∏è</span>
      <span class="gospel-title">Gospel Connection</span>
    </div>
    <div class="gospel-connection-content">
      <div class="gospel-reference">
        {{ scripture(reference) }}
      </div>
      <div class="gospel-explanation">
        {{ explanation }}
        {% if fulfillmentRef %}
          See also: {{ scripture(fulfillmentRef) }}
        {% endif %}
      </div>
    </div>
  </div>
{% endmacro %}

{# 
  Cross-reference macro for related passages
  Usage: {{ crossReference([
    {ref: "Matthew 5:17", note: "Jesus fulfills the law"},
    {ref: "Romans 3:21", note: "Righteousness apart from law"}
  ], "Law and Grace") }}
#}
{% macro crossReference(references, title="Cross References") %}
  <div class="cross-reference">
    <div class="cross-reference-header">
      <span class="cross-ref-icon">üîó</span>
      <h4 class="cross-ref-title">{{ title }}</h4>
    </div>
    <div class="cross-reference-list">
      {% for ref in references %}
        <div class="cross-ref-item">
          {{ scripture(ref.ref) }}
          {% if ref.note %}
            <span class="cross-ref-note">‚Äî {{ ref.note }}</span>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  </div>
{% endmacro %}

{# 
  Chapter summary with embedded references
  Usage: {{ chapterSummary("Genesis", 1, "In the beginning...", ["Genesis 1:1", "Genesis 1:27"]) }}
#}
{% macro chapterSummary(book, chapter, summary, keyVerses=[]) %}
  <div class="chapter-summary">
    <div class="chapter-summary-header">
      <h3>{{ book }} {{ chapter }}</h3>
      {% if keyVerses.length > 0 %}
        <div class="key-verses">
          <strong>Key Verses:</strong>
          {% for verse in keyVerses %}
            {{ scripture(verse) }}{% if not loop.last %}, {% endif %}
          {% endfor %}
        </div>
      {% endif %}
    </div>
    <div class="chapter-summary-content">
      {{ summary | safe }}
    </div>
  </div>
{% endmacro %}

{# 
  Theological theme box with Scripture support
  Usage: {{ theologicalTheme("Justification", "We are made right with God by faith alone", ["Romans 3:28", "Ephesians 2:8-9"]) }}
#}
{% macro theologicalTheme(theme, explanation, supportingVerses=[]) %}
  <div class="theological-theme">
    <div class="theme-header">
      <h4 class="theme-title">{{ theme }}</h4>
    </div>
    <div class="theme-content">
      <p class="theme-explanation">{{ explanation }}</p>
      {% if supportingVerses.length > 0 %}
        <div class="supporting-scriptures">
          <strong>Scripture Support:</strong>
          {% for verse in supportingVerses %}
            {{ scripture(verse) }}{% if not loop.last %}, {% endif %}
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>
{% endmacro %}

{# Add CSS styles for the macros #}
<style>
  /* Scripture Reference Styles */
  .scripture-reference {
    color: var(--accent, #2563eb);
    cursor: pointer;
    text-decoration: underline;
    text-decoration-style: dotted;
    position: relative;
  }

  .scripture-reference:hover {
    color: var(--accent-dark, #1e40af);
    text-decoration-style: solid;
  }

  .scripture-reference.inline {
    font-style: italic;
  }

  /* Scripture Block Styles */
  .scripture-block {
    background: var(--card, #f8fafc);
    border-left: 4px solid var(--accent, #2563eb);
    padding: 1rem 1.5rem;
    margin: 1.5rem 0;
    border-radius: 0 8px 8px 0;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }

  .scripture-block:hover {
    background: var(--bg-secondary, #f1f5f9);
  }

  .scripture-text {
    font-style: italic;
    font-size: 1.1rem;
    line-height: 1.6;
    margin-bottom: 0.5rem;
  }

  .scripture-ref {
    text-align: right;
    font-weight: 600;
    color: var(--accent, #2563eb);
    font-size: 0.9rem;
  }

  /* Scripture List Styles */
  .scripture-list {
    background: var(--bg-secondary, #f9fafb);
    border-radius: 8px;
    padding: 1.5rem;
    margin: 1.5rem 0;
  }

  .scripture-list-title {
    margin: 0 0 1rem 0;
    color: var(--text, #111827);
    font-size: 1.1rem;
  }

  .scripture-items {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .scripture-item {
    margin-bottom: 0.75rem;
    padding-left: 1rem;
    position: relative;
  }

  .scripture-item:before {
    content: "‚Ä¢";
    color: var(--accent, #2563eb);
    font-weight: bold;
    position: absolute;
    left: 0;
  }

  /* Gospel Connection Styles */
  .gospel-connection {
    background: linear-gradient(135deg, var(--success-light, #f0f9f3), var(--success, #10b981));
    border: 1px solid var(--success, #10b981);
    border-radius: 12px;
    padding: 1.5rem;
    margin: 2rem 0;
    color: var(--success-dark, #065f46);
  }

  .gospel-connection-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  .gospel-icon {
    font-size: 1.2rem;
  }

  .gospel-title {
    font-weight: 600;
    font-size: 1.1rem;
  }

  .gospel-reference {
    margin-bottom: 0.5rem;
  }

  .gospel-explanation {
    line-height: 1.6;
  }

  /* Cross Reference Styles */
  .cross-reference {
    background: var(--card, #ffffff);
    border: 1px solid var(--border, #e5e7eb);
    border-radius: 8px;
    padding: 1.5rem;
    margin: 1.5rem 0;
  }

  .cross-reference-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--border-light, #f3f4f6);
  }

  .cross-ref-icon {
    font-size: 1rem;
  }

  .cross-ref-title {
    margin: 0;
    font-size: 1rem;
    font-weight: 600;
  }

  .cross-ref-item {
    margin-bottom: 0.5rem;
    line-height: 1.5;
  }

  .cross-ref-note {
    color: var(--text-secondary, #6b7280);
    font-size: 0.9rem;
  }

  /* Chapter Summary Styles */
  .chapter-summary {
    background: var(--card, #ffffff);
    border: 1px solid var(--border, #e5e7eb);
    border-radius: 12px;
    padding: 1.5rem;
    margin: 1.5rem 0;
  }

  .chapter-summary-header {
    margin-bottom: 1rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid var(--border-light, #f3f4f6);
  }

  .chapter-summary-header h3 {
    margin: 0 0 0.5rem 0;
    color: var(--accent, #2563eb);
  }

  .key-verses {
    font-size: 0.9rem;
    color: var(--text-secondary, #6b7280);
  }

  /* Theological Theme Styles */
  .theological-theme {
    background: var(--warning-light, #fef3c7);
    border-left: 4px solid var(--warning, #f59e0b);
    border-radius: 0 8px 8px 0;
    padding: 1.5rem;
    margin: 1.5rem 0;
  }

  .theme-header {
    margin-bottom: 1rem;
  }

  .theme-title {
    margin: 0;
    color: var(--warning-dark, #92400e);
    font-size: 1.1rem;
  }

  .theme-explanation {
    line-height: 1.6;
    margin-bottom: 1rem;
  }

  .supporting-scriptures {
    font-size: 0.9rem;
    color: var(--text-secondary, #6b7280);
  }

  /* Dark mode support */
  @media (prefers-color-scheme: dark) {
    .scripture-block {
      background: var(--card-dark, #1f2937);
    }

    .scripture-list {
      background: var(--bg-secondary-dark, #111827);
    }

    .cross-reference {
      background: var(--card-dark, #1f2937);
      border-color: var(--border-dark, #374151);
    }

    .cross-reference-header {
      border-color: var(--border-light-dark, #4b5563);
    }

    .chapter-summary {
      background: var(--card-dark, #1f2937);
      border-color: var(--border-dark, #374151);
    }

    .chapter-summary-header {
      border-color: var(--border-light-dark, #4b5563);
    }
  }

  [data-theme="dark"] .scripture-block {
    background: var(--card-dark, #1f2937);
  }

  [data-theme="dark"] .scripture-list {
    background: var(--bg-secondary-dark, #111827);
  }

  [data-theme="dark"] .cross-reference {
    background: var(--card-dark, #1f2937);
    border-color: var(--border-dark, #374151);
  }

  [data-theme="dark"] .cross-reference-header {
    border-color: var(--border-light-dark, #4b5563);
  }

  [data-theme="dark"] .chapter-summary {
    background: var(--card-dark, #1f2937);
    border-color: var(--border-dark, #374151);
  }

  [data-theme="dark"] .chapter-summary-header {
    border-color: var(--border-light-dark, #4b5563);
  }
</style>